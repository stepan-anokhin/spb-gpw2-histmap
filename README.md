<h1 align="center">Ленинград под Огнём</h1>

<p align="center">Интерактивная историческая карта артиллерийских и авиа-ударов Ленинграда 
в период Блокады.</p>

<p align="center">
    <a href="https://github.com/stepan-anokhin/spb-histmap/actions?query=workflow%3AFrontend%20CI"><img src="https://github.com/stepan-anokhin/spb-histmap/workflows/Frontend%20CI/badge.svg?branch=master" alt="CI Workflow"></a>
    <a href="LICENSE"><img src="https://img.shields.io/github/license/stepan-anokhin/spb-histmap.svg" alt="License"></a> 
</p>

- [Планирование](#Планироавние)
- [Разработка](#Разработка)
  - [Сборка и Начало Работы](#Сборка-и-Начало-Работы)
  - [Исходные Данные](#Исходные-Данные)
    - [Исторические Данные](#Исторические-Данные)
    - [Тестовые Данные](#Тестовые-Данные)

## Планироавние

Текущие задачи находятся в проекте [Ленинград под Огнём](https://github.com/stepan-anokhin/spb-histmap/projects/1)

## Разработка

### Сборка и Начало Работы

Убедиться, что используется правильная версия `node.js`:

```shell
nvm use
```

Прогнать тесты:

```shell
npm run test
```

Собрать проект:

```shell
npm run build
```

Результаты сборки будут доступны в директории `./build`. Проект на данный момент не
использует никакой бэкенд, все исторические данные зашиты во фронт. Чтобы
задеплоить приложение достаточно статически сёрвить содержимое папки `./build`
по URL `/`. Например команды `cd ./build && python3 -m http.server <port>`
должно быть достаточно, чтобы приложение стало доступно по соответствующему порту.

Запустить dev-сервер с динамической подгрузкой изменений:

```shell
npm run dev
```

Локальный dev-сервер будет доступен по следующему по [http://localhost:9999/](http://localhost:9999/)

### Исходные Данные

Артиллерийские удары, отображаемые на карте, находятся в файле `./src/data.ts`.
Данный файл генерируется программно по исходным данным.

#### Исторические Данные

Пока не реализовано. В данном разделе будет описано:

1. В каком формате хранятся исходные исторические данные
2. Как на их основе генерируется файл `./src/data.ts`

#### Тестовые Данные

Поскольку реальные исторические данные по артиллерийским ударам на начальном этапе
разработки не доступны, для целей тестирования приложения файл `./src/data.ts`
содержит случайные тестовые данные.

Чтобы сгенерировать тестовые данные надо выполнить:

```shell
rm src/data.ts
npm run generate:fake-data
```

Чтобы сгенерировать тестовые данные заданного объема в `generate:fake-data` можно передать
необходимое количество событий:

```shell
npm run generate:fake-data -- 10000
```

Адреса домов для тестовых данных берутся из файла `src/processing/spb-houses.ts`,
который также генерируется програмно:

```shell
rm src/processing/spb-houses.ts
npm run generate:spb-houses
```

Команда `generate:spb-houses` скачивает гео-данные OpenStreetMap по
Санкт-Петербургу (в формате [OSM](https://wiki.openstreetmap.org/wiki/OSM_XML))
в папку `./data`, извлекает известные адреса домов вместе с координатами и
записывает их в `src/processing/spb-houses.ts`.

Исходные гео-данные по Санкт-Петербургу изначально получены с помощью сервиса
[BBike](https://extract.bbbike.org/), перепакованы в `zip`-архив и выложены
для скачивания по адресу https://stepan-anokhin.github.io/data/spb-geodata.osm.zip,
откуда их забирает скрипт `generate:spb-houses`.
